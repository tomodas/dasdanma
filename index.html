<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ボス戦シューティング</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; background: black; }
    #score, #bossHp {
      position: absolute;
      color: white;
      font-size: 20px;
      font-family: sans-serif;
      left: 10px;
    }
    #bossHp {
      top: 40px;
    }
  </style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="bossHp">Boss HP: 100</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// プレイヤー設定
const player = {
  x: canvas.width / 2,
  y: canvas.height - 100,
  radius: 10,
  color: 'cyan',
  speed: 6,
  moveLeft: false,
  moveRight: false,
  moveUp: false,
  moveDown: false,
};

// プレイヤーの弾
let playerBullets = [];

// ボス設定
const boss = {
  x: canvas.width / 2,
  y: 100,
  radius: 40,
  color: 'purple',
  speedX: 3,
  speedY: 1.5,
  directionX: 1,
  directionY: 1,
  hp: 100,
};

// ボスの弾
let bossBullets = [];
let score = 0;

// キーボード操作
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') player.moveLeft = true;
  if (e.key === 'ArrowRight') player.moveRight = true;
  if (e.key === 'ArrowUp') player.moveUp = true;
  if (e.key === 'ArrowDown') player.moveDown = true;
  if (e.key === ' ') shootPlayerBullet(); // スペースキーで攻撃
});
document.addEventListener('keyup', (e) => {
  if (e.key === 'ArrowLeft') player.moveLeft = false;
  if (e.key === 'ArrowRight') player.moveRight = false;
  if (e.key === 'ArrowUp') player.moveUp = false;
  if (e.key === 'ArrowDown') player.moveDown = false;
});

// プレイヤー弾を撃つ
function shootPlayerBullet() {
  playerBullets.push({
    x: player.x,
    y: player.y,
    radius: 5,
    color: 'lime',
    vy: -8,
  });
}

// ボスが弾を撃つ
function spawnBossBullets() {
  const bulletCount = 30;
  const angleOffset = Math.random() * Math.PI * 2;
  for (let i = 0; i < bulletCount; i++) {
    const angle = (i / bulletCount) * Math.PI * 2 + angleOffset;
    bossBullets.push({
      x: boss.x,
      y: boss.y,
      vx: Math.cos(angle) * (2 + Math.random() * 1.5),
      vy: Math.sin(angle) * (2 + Math.random() * 1.5),
      radius: 6,
      color: 'red',
    });
  }
}

// メイン更新
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // プレイヤー移動
  if (player.moveLeft) player.x -= player.speed;
  if (player.moveRight) player.x += player.speed;
  if (player.moveUp) player.y -= player.speed;
  if (player.moveDown) player.y += player.speed;
  player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
  player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));

  // ボス移動（上下左右）
  boss.x += boss.speedX * boss.directionX;
  boss.y += boss.speedY * boss.directionY;
  if (boss.x < boss.radius || boss.x > canvas.width - boss.radius) boss.directionX *= -1;
  if (boss.y < boss.radius || boss.y > canvas.height / 2) boss.directionY *= -1;

  // ボス描画
  ctx.beginPath();
  ctx.arc(boss.x, boss.y, boss.radius, 0, Math.PI * 2);
  ctx.fillStyle = boss.color;
  ctx.fill();

  // プレイヤー描画
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fillStyle = player.color;
  ctx.fill();

  // プレイヤー弾更新・描画
  playerBullets.forEach((bullet, index) => {
    bullet.y += bullet.vy;
    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
    ctx.fillStyle = bullet.color;
    ctx.fill();

    // ボスに当たったか
    const dx = bullet.x - boss.x;
    const dy = bullet.y - boss.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    if (distance < bullet.radius + boss.radius) {
      boss.hp -= 5;
      playerBullets.splice(index, 1);
      if (boss.hp <= 0) {
        alert('ボス撃破！おめでとう！ スコア: ' + score);
        location.reload();
      }
    }
  });

  // ボス弾更新・描画
  bossBullets.forEach((bullet, index) => {
    bullet.x += bullet.vx;
    bullet.y += bullet.vy;

    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
    ctx.fillStyle = bullet.color;
    ctx.fill();

    // プレイヤーに当たったか
    const dx = bullet.x - player.x;
    const dy = bullet.y - player.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    if (distance < bullet.radius + player.radius) {
      alert('ゲームオーバー！スコア: ' + score);
      location.reload();
    }

    // 画面外削除
    if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
      bossBullets.splice(index, 1);
    }
  });

  // スコア
  score++;
  document.getElementById('score').innerText = 'Score: ' + score;
  document.getElementById('bossHp').innerText = 'Boss HP: ' + boss.hp;

  requestAnimationFrame(update);
}

// ボス弾発射間隔
setInterval(spawnBossBullets, 1000);

// スタート
update();
</script>
</body>
</html>
